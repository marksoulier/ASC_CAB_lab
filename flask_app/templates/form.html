<!-- form.html -->
<div class="form-container">
    <form id="uploadForm" action="/upload" method="post" enctype="multipart/form-data">
        <div class="file-upload-container">
            <input type="file" name="file" id="file" style="display: none;" onchange="updateFileName()">
            <label for="file" class="file-label">Choose File</label>
            <span id="file-name" class="file-name"></span>
        </div>
        <button type="submit" class="upload-btn">Upload File</button>
    </form>
    <div id="uploadProgressBar" style="width:0%; height: 20px; background-color: #4CAF50;"></div>
</div>

<script>
document.getElementById('uploadForm').onsubmit = function(event) {
    // Start the progress bar
    startProgress();

    // The form submission is not prevented; it will continue after this function
};

document.getElementById('toggleForm').onsubmit = function(event) {
    // Start the progress bar
    startProgress2();

    // The form submission is not prevented; it will continue after this function
};

function startProgress() {
    var progressBar = document.getElementById('uploadProgressBar');
    var width = 0;
    var totalTime = 120; // Duration in seconds for the progress bar to fill
    var intervalTime = 100; // Interval time in milliseconds
    var increment = intervalTime / (totalTime * 1000) * 100; // Calculate increment to reach 100% in the desired time

    var interval = setInterval(function() {
        if (width >= 100) {
            clearInterval(interval);
        } else {
            width += increment;
            progressBar.style.width = width + '%';
        }
    }, intervalTime);
}

function startProgress2() {
    var progressBar = document.getElementById('executeProgressBar');
    var width = 0;
    var totalTime = 200; // Duration in seconds for the progress bar to fill
    var intervalTime = 100; // Interval time in milliseconds
    var increment = intervalTime / (totalTime * 1000) * 100; // Calculate increment to reach 100% in the desired time

    var interval = setInterval(function() {
        if (width >= 100) {
            clearInterval(interval);
        } else {
            width += increment;
            progressBar.style.width = width + '%';
        }
    }, intervalTime);
}

function updateFileName() {
    var input = document.getElementById('file');
    var fileNameSpan = document.getElementById('file-name');
    var fileName = input.value.split('\\').pop(); // Extract the file name from the path
    fileNameSpan.textContent = fileName; // Display the file name
}
</script>
<hr>
<div id="file-categories">
    {% if file_counts %}
        <h2>Data Cleaning complete you can find cleaned data in the folder you launched the app.</h2>
        <hr>
        <h2>Uploaded File Categories</h2>
        <p>Content files: {{ file_counts.get('content', 0) }}</p>
        <p>Data files: {{ file_counts.get('data', 0) }}</p>
        <p>Other files: {{ file_counts.get('other', 0) }}</p>
        
        <h3>Sample Files</h3>
        {% for category, files in file_categories.items() %}
            <h4>{{ category.capitalize() }} Files</h4>
            <ul>
                {% for file in files %}
                    <li>{{ file }}</li>
                {% endfor %}
            </ul>
        {% endfor %}
        <h2>Participants {{ participant_count }}</h2>
        <hr>
        <h2>Content</h2>
        <div>
            {% for content_name, file_path in content.items() %}
                <p>{{ content_name }}: {{ file_path }}</p>
            {% endfor %}
        </div>

        <hr>
        <h2>Data Files</h2>
        {% for data_file in data_files %}
            <p>{{ data_file }}</p>
        {% endfor %}

        <hr>
    {% endif %}
</div>

<h2>Create Custom Video</h2>
{% if participants %}
<form id="toggleForm" method="POST" action="/execute">
    <label>
        Participant:
        <select name="participant" id="participant">
                <!-- Set the first participant as the default option -->
                <option value="{{ participants[0] }}">{{ participants[0] }}</option>
                {% for participant in participants[1:] %}
                    <!-- Loop through the rest of the participants, starting from the second one -->
                    <option value="{{ participant }}">{{ participant }}</option>
                {% endfor %}
        </select>
    </label><br>
    <label>
        GSR:
        <input type="checkbox" name="GSR" id="GSR">
    </label><br>
    <label>
        FACET:
        <input type="checkbox" name="FACET" id="FACET">
    </label><br>
    <label>
        Blink:
        <input type="checkbox" name="Blink" id="Blink">
    </label><br>
    <label>
        Pupil:
        <input type="checkbox" name="Pupil" id="Pupil">
    </label><br>
    <label>
        HeartRate:
        <input type="checkbox" name="HeartRate" id="HeartRate">
    </label><br>
    <label>
        graph:
        <input type="checkbox" name="graph" id="graph">
    </label><br>
    <label>
        save:
        <input type="checkbox" name="save" id="save">
    </label><br>
    <label>
        show:
        <input type="checkbox" name="show" id="show">
    </label><br>
    <label>
        eye_tracking:
        <input type="checkbox" name="eye_tracking" id="eye_tracking">
    </label><br>
    <button type="button" onclick="execute()">Create Video</button></form>
    <div id="executeProgressBar" style="width:0%; height: 20px; background-color: #001dfc;"></div>
{% endif %}
<script>
    function execute() {
        var formData = new FormData();
        formData.append('GSR', document.getElementById('GSR').checked ? 'True' : 'False');
        formData.append('Blink', document.getElementById('Blink').checked ? 'True' : 'False');
        formData.append('FACET', document.getElementById('FACET').checked ? 'True' : 'False');
        formData.append('Pupil', document.getElementById('Pupil').checked ? 'True' : 'False');
        formData.append('HeartRate', document.getElementById('HeartRate').checked ? 'True' : 'False');
        formData.append('graph', document.getElementById('graph').checked ? 'True' : 'False');
        formData.append('save', document.getElementById('save').checked ? 'True' : 'False');
        formData.append('show', document.getElementById('show').checked ? 'True' : 'False');
        formData.append('eye_tracking', document.getElementById('eye_tracking').checked ? 'True' : 'False');
        formData.append('participant', document.getElementById('participant').value);

        fetch('/execute', {
            method: 'POST',
            body: formData
        })
        .then(response => response.text())
        .then(data => console.log(data))
        .catch(error => console.error('Error:', error));
    }
</script>
